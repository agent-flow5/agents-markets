## 后端环境变量在哪里配？

后端是 Cloudflare Workers（Wrangler）项目，启动脚本在 [package.json](file:///Users/ashy/Documents/code/agents-market/apps/backend/package.json)：

- 本地开发：`npm run dev -w apps/backend`（等价于在 `apps/backend` 目录执行 `wrangler dev --local --port 3300`）
- 线上部署：`npm run deploy -w apps/backend`（`wrangler deploy`）

Wrangler 在本地开发时会自动读取 `apps/backend/.dev.vars` 作为环境变量来源。

## 本地开发配置（推荐）

1. 打开示例文件：[.dev.vars.example](file:///Users/ashy/Documents/code/agents-market/apps/backend/.dev.vars.example)
2. 复制一份为：`apps/backend/.dev.vars`
3. 把里面的 `********` / `xxxxxxxx` 替换成你自己的值
4. 启动后端：`npm run dev -w apps/backend`

## 线上部署配置（Cloudflare Workers）

线上不读取 `.dev.vars` 文件，需要在 Cloudflare 侧配置环境变量/密钥：

- Cloudflare Dashboard：Workers & Pages → 选中该 Worker（`agents-market-backend`）→ Settings → Variables
- 或 Wrangler CLI：
  - 机密（推荐放 Key）：`wrangler secret put OPENAI_API_KEY`、`wrangler secret put VOLCENGINE_API_KEY`
  - 普通变量（比如 Base URL / endpointId）：`wrangler vars put VOLCENGINE_BASE_URL https://ark.cn-beijing.volces.com/api/v3`

## 变量说明（OpenAI 与火山方舟/豆包）

下面这些是当前后端实际会用到的变量（模型列表见 [list.ts](file:///Users/ashy/Documents/code/agents-market/apps/backend/src/data/list.ts)，提供商初始化见 [providers.ts](file:///Users/ashy/Documents/code/agents-market/apps/backend/src/lib/ai/providers.ts)）：

### OpenAI

- `OPENAI_API_KEY`
  - 含义：OpenAI API Key（仅后端使用）
  - 获取：OpenAI 控制台创建 Key
  - 用途：调用 OpenAI 模型（如 `gpt-4o`, `gpt-4o-mini`）

### 火山方舟（兼容 OpenAI 协议）

- `VOLCENGINE_BASE_URL`
  - 含义：火山方舟 OpenAI 兼容网关地址
  - 常用示例：`https://ark.cn-beijing.volces.com/api/v3`
  - 获取：火山方舟控制台的 API 接入地址（按区域不同会变化）

- `VOLCENGINE_API_KEY`（或 `VOLC_API_KEY` 二选一）
  - 含义：火山方舟 API Key
  - 获取：火山方舟控制台创建 Key

### 火山方舟“模型入口（Endpoint）”配置

本项目里火山侧模型不是直接写模型名，而是通过“Endpoint ID”来调用（通常长得像 `ep-2026xxxxxxxx-xxxxx`）。这些 Endpoint ID 需要配置到对应的环境变量里（见 [list.ts](file:///Users/ashy/Documents/code/agents-market/apps/backend/src/data/list.ts) 的 `volcengine.endpointIdEnv` 字段）：

- `VOLCENGINE_MODEL_DOUBAO_PRO`：Doubao Pro 32k 的 endpointId
- `VOLCENGINE_MODEL_DEEPSEEK_R1`：DeepSeek R1 系列的 endpointId
- `VOLCENGINE_MODEL_DEEPSEEK_V3`：DeepSeek V3 系列的 endpointId
- `VOLCENGINE_MODEL_DOUBAO_SEEDREAM`：Doubao Seedream 4.5（图像生成）endpointId

你在火山方舟控制台创建/绑定 Endpoint 后，把对应的 `ep-...` 填进这些变量即可。

#### Endpoint ID（ep-xxx）在哪里找？怎么创建并复制？

在火山方舟里，“模型入口（Endpoint）”相当于一个可调用的推理接入点：你先创建一个 Endpoint，把它绑定到某个具体模型（Doubao / DeepSeek / Seedream 等），创建成功后会拿到一个 `ep-...` 的 Endpoint ID。本项目需要的就是这个 `ep-...`。

常见流程（控制台路径名称可能略有差异，但关键是找到 Endpoint/接入点管理页）：

1. 登录火山引擎控制台 → 进入「方舟平台 / 火山方舟（Ark）」。
2. 找到「Endpoint / 推理接入点 / 在线推理」相关页面，点击「创建 Endpoint（创建接入点）」。
3. 在创建页面选择你要绑定的模型（例如 Doubao Pro、DeepSeek R1、DeepSeek V3、Seedream 等），按提示完成创建。
4. 创建成功后进入 Endpoint 详情页：
   - 页面会显示 Endpoint ID（一般以 `ep-` 开头），复制它。
   - 同时通常也会显示该 Endpoint 的调用示例/请求地址（本项目用的是 `VOLCENGINE_BASE_URL` + API Key，不需要把 URL 写进 endpointId）。
5. 把复制到的 `ep-...` 写进本项目对应变量：
   - Doubao Pro 32k → `VOLCENGINE_MODEL_DOUBAO_PRO=ep-...`
   - DeepSeek R1 → `VOLCENGINE_MODEL_DEEPSEEK_R1=ep-...`
   - DeepSeek V3 → `VOLCENGINE_MODEL_DEEPSEEK_V3=ep-...`
   - Seedream 4.5 → `VOLCENGINE_MODEL_DOUBAO_SEEDREAM=ep-...`

提示：

- 这些 `VOLCENGINE_MODEL_*` 变量不是“模型名称”，而是“你在方舟控制台创建出来的 Endpoint ID”。
- `VOLCENGINE_MODEL_DOUBAO_SEEDREAM` 是图像生成模型的 Endpoint；当前后端只有对话接口（/chat），Seedream 这类模型不能走对话接口，仅用于后续接入文生图/图生图时使用。

## 其它变量（可选）

- `CORS_ORIGIN`
  - 含义：允许跨域访问的前端地址列表（逗号分隔），例如 `http://localhost:5173`
  - 位置：后端接口 CORS 逻辑在 [api.ts](file:///Users/ashy/Documents/code/agents-market/apps/backend/src/api.ts)

## 说明：示例文件里有些变量当前未使用

[.dev.vars.example](file:///Users/ashy/Documents/code/agents-market/apps/backend/.dev.vars.example) 里包含 `VOLCENGINE_CHAT_MODEL`、`VOLCENGINE_EMBEDDING_MODEL`、`DATABASE_URL`、`BACKEND_PORT` 等字段，但在当前 `apps/backend/src` 代码里没有被读取；目前后端主要依赖的是：

- OpenAI：`OPENAI_API_KEY`
- 火山：`VOLCENGINE_BASE_URL` + `VOLCENGINE_API_KEY`/`VOLC_API_KEY` + `VOLCENGINE_MODEL_*`（各模型 endpointId）
- CORS：`CORS_ORIGIN`（可选）
